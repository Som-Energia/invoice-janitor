general:
  description: Informació General
  scripts:
    quadrecontrolgeneral:
      script: python SOME_SRC/somenergia-scripts/Informacio/General_Quadre_control.py -d {date}
      title: Quadre de control de comercializació
      description: >
        Aquest quadre de control et permet veure la situació molt genèrica
        de com està la comercialitació.
        Ens serveix per omplir el Quadre de Control del drive.
        Si teniu peticions de noves coses a controlar podeu escriure a en Pere.
      send:
        to:
        - '{mail}'
      parameters:
        mail:
          description: Introdueix el correu electrònic # TODO, si vols rebre la informació per correu
        date:
          description: Introdueix la data (inclosa) fins a la que vols fer l'estudi amb el format 'YYYY-mm-dd'

measurefixing:

  description: Facturació. Validació de lectures
  scripts:

    quadrecontrolvalidacio:
#      script: execute_send_email.py -C ~/config.py -s [Web_Scripts]_Quadre_de_control_validacio -t {mail} -- SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio_Quadre_control.py
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio_Quadre_control.py
      title: Quadre de control Validació
      description: Serveix per quantificar els errors que actualment tenim en el validació de les lectures. 
      parameters:
        mail:
          description: Introdueix el correu electrònic
          default: pere.roig@somenergia.coop

    canvicomptadors:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/rectificar_lectures_canvi_comptador.py
      title: Canvi de comptadors
      description: Gestiona els canvi de comptadors que no han estat informant i hem seguit facturant-los amb estimades fetes per Som Energia. Informa per pantalla els errors que hi han en el rpocés pe rtla de que es puguin solucionar per temàtica i anar veient quines es poden automatitzar.

    errorsprincipals:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio0_errors_principal.py
      title: Script principal
      description: >
        Ha d'acabar sent l'script on s'excutint tots els altres
        scripts de correcció de lectures en el procés de validació.
        Per ara fa una validació de tots els errors de lectura i
        soluciona els problemes de lectures amb les 3.1A.
    validacionbajas:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio1_baixes_2.py
      title: Corregir errors en baixes
      description: 

    polizasbajas:  
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio2_eliminar_polisses_baixa.py
      title: Eliminar pòlisses de baixa
      description: 

    sobrestimacions_ab_re:
      script: execute_send_email.py -C ~/config.py -s [Web_Scripts]_Resultat_sobreestimacions_AB_i_RE -t {mail} -- python SOME_SRC/somenergia-scripts/invoicing/invoicefixing/fix_detained_invoicing.py
      title: Corregir Sobreestimaciones amb AB i RE
      description: >
         Identifiquem tots els casos que hem fet sobreestimacions,
         i triem els que tenen un consum major del consum mensual del contracte i menor a 5 cops al consum mensual.
         Els solucionem fent abonaments i rectificadores.
      parameters:
        mail:
          description: Introdueix el correu electrònic
          default: pere.roig@somenergia.coop
    sobreestimaciones:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio3_sobre_estimacions.py
      title: Corregir Sobreestimaciones
      description:  

    sinlecturamaximetro:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio4_sense_lectura_maximetre.py
      title: Corregir errors en lectures de maximetre
      description: 

    validacionincompleta:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio5_incompleta.py
      title: Corregir lectures que estan incompletes
      description: 

    lecturacierre:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio6_lectura_tancament.py
      title: Corregir lectures de tancament de comptadors (passar-lo fins que no l'ajuntem amb l'altre)
      description: 

    cierremejorado:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio7_tancament_millorat.py
      title: Corregir lectures de tancament de comptadors (millorat)
      description: 

    senselectureanterior:
      script: SOME_SRC/somenergia-scripts/invoicing/measurefixing/Validacio8_sense_lectura_anterior.py
      title: Corregir pòlisses que no es troba la lectura anterior.
      description: 

invoicefixing:
  description: Facturació. Eines per lots, F1 i factures
  scripts:

    quadrecontrolesborrany:
      script: SOME_SRC/somenergia-scripts/invoicing/invoicefixing/qc_facturesesborrany.py -C  SOME_SRC/somenergia-scripts/invoicing/configdb.py
      title: Quadre de control Factures en esborrany
      description: Serveix per quantificar els errors que podem detectar a les factures en esborrany

    quadrecontrolF1:
      script: SOME_SRC/somenergia-scripts/Importacions_F1_Q1/Fact_impF1_QuadreDeControl.py -C  SOME_SRC/somenergia-scripts/invoicing/configdb.py
      title: Quadre de control de F1
      description: Serveix per quantificar els errors detectats a les importacions de F1
      parameters:
        date:
          description: Introduir la data des de quan voleu fer la cerca amb format YYYY-mm-dd

    fixmoddate:
      script: python SOME_SRC/somenergia-scripts/invoicing/fix_modcontractual_orig.py
      title: Corregir errors data de modificació contractual 
      description:

    fixextraline:  
      script: SOME_SRC/somenergia-scripts/invoicing/fix_extra_line.py
      title: Corregir errors extra line
      description: 

    arreglar0lines:
      title: Arreglar Factures amb 0 Lines
      description: >
        Aquest script arregla les factures en esborrany que no tenen linies de energia.
        Per ara arregla les que tenen les lectures en la modificació activa,
        les altres les haurem de resoldre manualment.
      script: SOME_SRC/somenergia-scripts/invoicing/report_0days_0kWh.py -C  SOME_SRC/somenergia-scripts/invoicing/configdb.py

    ReImportF1:
      script: python SOME_SRC/somenergia-scripts/Importacions_F1_Q1/Reimportar_XML_F1.py -c {cups} -i {info} -d {date}
      title: Reimportar F1 massivament
      description: Importa massivament els F1, ja sigui pel cups o per la info. Pots posar una data des d'on inicii la cerca
      parameters:
        cups:
          description: Introduir el CUPS
        info:
          description: Introduir un tros del missatge que indentifiqui clarament quin és
        date:
          description: Introduir la data des de quan voleu fer la cerca amb format YYYY-mm-dd

    fixrefundinvoice:
      script:
        - SOME_SRC/somenergia-scripts/invoicing/invoicefixing/fix_refund_invoice.py
        - -i
        - "{invoice}"
      title: Corregir factura rectificativa
      description: 
      parameters:
        invoice:
          description: Invoice number

    fixinvoice:
      script: python SOME_SRC/somenergia-scripts/invoicing/invoicefixing/fix_invoice.py -c {contract_name} -s {start_date} -e {end_date}
      title: Abonar i rectificar
      description: 
      parameters:
        contract_name:
          description: Número de contracte
        start_date:
          description: data inici
        end_date:
          description: data final

    killalreadyexist:
      script: python SOME_SRC/somenergia-scripts/Importacions_F1_Q1/Fact_impF1_eliminar_Ja_existeix.py
      title: Eliminar importacions de F1 repetides o invàlides
      description: Elimina les importacions de F1 amb el text d'error "Ja existeix una factura...", "XML erroni", "XML no correspon al tipus F1" i "Document invàlid"

    reqadq:
        script: python SOME_SRC/somenergia-scripts/Peticions/peticio_lectures.py {nmsgs} 
        title: Petició d'autolectures
        description: Petició d'autolectures (5 mesos sense lectures reals) 
        parameters:
          nmsgs:
            description: Número de missatges a enviar

    contractmove:
      script: python SOME_SRC/somenergia-scripts/lots/moure_polisses.py
      title: Moure polisses al lot següent
      description: ATENCIÓ! Aquest script només s'ha d'utiltizar quan es vol fer canvi de lot i lot actual el volem tancar. Aquest scripts et permet moure les polisses que falten per facturar al següent lot


gestiocontractes:
    description: Gestió de contractes
    scripts:
      canvistitular:
        script: execute_send_email.py -C ~/config.py -s canvi_titular -t modifica@somenergia.coop -- python SOME_SRC/somenergia-scripts/Revisions_periodiques/canvi_titular_fase3.py
        title: Canvi de titular. Última fase
        description: Un cop ens arriben els M102 d'accpetació de canvi de titular, fem totes les accions per donar de baixa el contracte vell i crear el nou amb el nou titular.
      quadrecontrolsw:
        script: python SOME_SRC/somenergia-scripts/Informacio/switching_qc.py
        title: Quadre de control Gestió de contractes
        description: Aquest quadre de control permet veure la situació dels processos. Veiem si tenim endarreriments en alguns dels passos del cas
      quadrecontrol3:
        script: python SOME_SRC/somenergia-scripts/Informacio/tres_qc.py {date}
        title: Quadre de control de tarifa 3.0A
        description: Aquest quadre de control està en construcció. Potser hi ha funcionalitats que s'haurien de tractar a fora d'aquest quadre. S'hi ha de treballar una mica més.
        parameters:
          date:
            description: Introdueix la data dels des dels quals vols veure els nous contractes amb el format 'YYYY-mm-dd'
      seguiment3:
        script: 
        - python
        - SOME_SRC/somenergia-scripts/Informacio/seguiment_30A.py
        - "-d {date}"

        title: Seguiment de contractes nous 3.0A i contractes endarrerits en esborrany
        description: 
        parameters:
          date:
            description: Introdueix la data amb el format 'YYYY-mm-dd', l'última no inclosa
      cupstoemailb:
        script: SOME_SRC/cups2email/cups2email_lang_b.py {file}
        title: Email validació de instalació a partir dels CUPS facilitats per la distribuidora
        description: 
        parameters:
          file:
            type: FILE
            description: Excel con los cups
      cupstoemaila:
        script: SOME_SRC/cups2email/cups2email_lang_a.py {file}
        title: Email petició documentació a partir dels CUPS facilitats per la distribuidora
        description: 
        parameters:
          file:
            type: FILE
            description: Excel con los cups

admin:
  description: Administració
  scripts:
    municipaltax:
      script: python SOME_SRC/somenergia-scripts/Taxes/municipaltax.py {file} {start_date} {end_date} {filetype}
      title: Generació fitxers agrupats impost municipal 1.5%
      description:
      parameters:
        file:
          type: FILE
          description: CSV dades municipi
        start_date:
          description: data inici (ex. 2015-01-01)
        end_date:
          description: data final (ex. 2015-03-31)
        filetype:
          description: format sortida (xml|csv)
    municipaltaxdetail:
      script: python SOME_SRC/somenergia-scripts/Taxes/municipaltax_detailed.py {ine} {start_date} {end_date}
      title: Generació detall impost municipal 1.5%
      description:
      parameters:
        ine:
          description: INE municipi
        start_date:
          description: data inici (ex. 2015-01-01)
        end_date:
          description: data final (ex. 2015-03-31)

generation:
  description: Generació
  scripts:
    formatejaprevisions:
      title: Formateja arxius de previsió
      script:
      - python
      - -c
      - celles='{celles}'; print ';'.join(x.replace(',', '.') for x in celles.split())
      description: Formateja arxius de previsió
      parameters:
        celles:
          description: Enganxa les celles de l'Excel >

validation:
  description: Validació de codis
  scripts:
    checkiban:
      title: Check IBAN
      script: python SOME_SRC/somenergia-api-validators/check_iban.py {iban}
      parameters:
        iban:
          description: IBAN code
    checkvat:
      title: Check DNI/NIF
      script: python SOME_SRC/somenergia-api-validators/check_vat.py {vat}
      parameters:
        vat:
          description: DNI/NIF
    checkcups:
      title: Check CUPS
      script: python SOME_SRC/somenergia-api-validators/check_cups.py {cups}
      parameters:
        cups:
          description: CUPS
    checkcnae:
      title: Check CNAE
      script: python SOME_SRC/somenergia-api-validators/check_cnae.py {cups}
      parameters:
        cnae:
          description: CNAE
